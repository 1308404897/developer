webpackJsonp([3],{"1BRe":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("3cXf"),a=r.n(n),s=r("0Njg"),i=r("R2SV"),o={data:function(){return{width:1e3,height:600,title:"新增用例",disabled:!1,functionListApi:s.t,id:this.$route.params.id,packageId:null,form:{name:null,workflow:null},presetParams:[]}},computed:{},methods:{addPresetParams:function(){this.presetParams.push({key:"",value:"",type:"text"}),console.log(this.presetParams)},save:function(){var e=this;this.$refs.edit.validate(function(t){if(t){var r=e.$refs.workflow.validate();r.result?e.$confirm("确定保存？","提示",{type:"info"}).then(function(){e.disabled=!0,e.id?Object(s._11)(e.id,e.generateParams()).then(function(t){e.$transfer({back:"再次编辑",buttons:[{text:"去列表",link:"/flow/testCase"}]})}).catch(function(){e.disabled=!1}):Object(s.h)(e.generateParams()).then(function(t){e.$transfer({back:"继续添加",buttons:[{text:"去列表",link:"/flow/testCase"}]})}).catch(function(){e.disabled=!1})}):e.$message({message:r.message,type:"warning"})}else e.$message({message:"请输入用例名称",type:"warning"})})},generateParams:function(){return{workflow:a()(this.$refs.workflow.workflow()),name:this.form.name,presetParams:a()(this.presetParams),packageId:this.packageId}},test:function(){var e=this,t=this.$refs.workflow.validate();if(t.result){this.$refs.runnerDialog.open();var r={workflow:this.$refs.workflow.workflow(),presetParams:this.presetParams};setTimeout(function(){return e.$refs.runner.setData(r)},500)}else this.$message({message:t.message,type:"warning"})},runTest:function(){this.$refs.runner.run()},beautify:function(){this.$refs.workflow.beautify()}},components:{"v-runner":function(){return r.e(32).then(r.bind(null,"V7zm"))},"v-dialog":function(){return r.e(29).then(r.bind(null,"j9Pd"))},"v-selector":function(){return r.e(31).then(r.bind(null,"qNHp"))},"v-workflow":function(){return r.e(36).then(r.bind(null,"2fbX"))},"v-parameter-input":function(){return r.e(33).then(r.bind(null,"WfCw"))}},mounted:function(){var e=this,t=Object(i.g)().packageId;t?(this.disabled=!0,this.packageId=t,Object(s.C)(t).then(function(t){e.form.name=t.name,Object(s.K)({rows:1e3,idList:t.interfacesIdList}).then(function(t){if(t&&t.length>0){for(var r=[],n=e.width/2-200,a=0;a<t.length;++a){var s=t[a],o=s.name;o.length>16?o=o.substr(0,8)+"\r\n"+o.substr(8,7)+"...":o.length>8&&(o=o.substr(0,8)+"\r\n"+o.substr(8,o.length));var l={interfaceId:s.id,interfaceName:o,history:!1,hash:s.hash,headers:[],javascript:null,java:s.java,url:s.url,sleep:null,returns:JSON.parse(s.returns),method:s.method,parameters:Object(i.d)(s.parameters)},c="g"+a,u={id:c,type:"rect",label:"（"+c+"）"+o,x:n+a%3*190,y:100*(parseInt(a/3)+1),data:l};r.push(u)}e.form.workflow={nodes:r}}else e.form.workflow={};e.disabled=!1})})):this.id?(this.title="修改用例",Object(s.F)(this.id).then(function(t){e.form.name=t.name,e.form.workflow=JSON.parse(t.workflow),e.presetParams=JSON.parse(t.presetParams)}).catch(function(e){console.log(e)})):this.$set(this.form,"workflow",{})}},l={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h4",{staticClass:"title"},[e._v(e._s(e.title))]),e._v(" "),r("hr"),e._v(" "),r("el-form",{ref:"edit",staticStyle:{"max-width":"1100px"},attrs:{model:e.form,"label-width":"8em"}},[r("el-form-item",{attrs:{label:"用例名称:",prop:"name",required:"",rules:[{required:!0,message:"请输入用例名称",trigger:["blur","change"]}]}},[r("el-input",{attrs:{placeholder:"请输入用例名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"预置参数:"}},[r("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"small"},on:{click:function(t){return e.addPresetParams()}}}),e._v("\n      在后续脚本中使用，如设置了参数名为：name=value，使用 $name 即可获得此参数对应的值value，不要重复命名\n      "),r("v-parameter-input",{attrs:{parameters:e.presetParams}})],1),e._v(" "),r("el-form-item",{attrs:{label:"配置流程:","label-width":"8em"}},[r("div",{staticClass:"testcase_editor_container",style:{width:e.width+2+"px"}},[e.form.workflow?r("v-workflow",{ref:"workflow",attrs:{"data-list":e.form.workflow,width:e.width,height:e.height}}):e._e()],1)]),e._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"info",icon:"el-icon-back"},on:{click:function(t){return e.$router.go(-1)}}},[e._v("返回")]),e._v(" "),r("el-button",{attrs:{type:"primary",icon:e.disabled?"el-icon-loading":"el-icon-success",disabled:e.disabled},on:{click:e.save}},[e._v("提交")]),e._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-s-grid"},on:{click:e.beautify}},[e._v("美化")]),e._v(" "),r("el-button",{attrs:{type:"success",icon:"el-icon-magic-stick"},on:{click:e.test}},[e._v("测试")])],1)],1),e._v(" "),r("v-dialog",{ref:"runnerDialog",attrs:{title:"运行用例","ok-text":"开始执行","cancel-text":"关闭",ok:e.runTest,width:1300}},[r("div",{attrs:{slot:"body"},slot:"body"},[r("v-runner",{ref:"runner",attrs:{width:1100,height:518}})],1)])],1)},staticRenderFns:[]};var c=r("C7Lr")(o,l,!1,function(e){r("auwJ")},"data-v-5ad4798c",null);t.default=c.exports},auwJ:function(e,t){}});
//# sourceMappingURL=3.5e7cc9f3d4bbda685de0.js.map